<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="John D. Lloyd">

<title>Streaked Horned Lark detectability and abundance: preliminary results</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="preliminaryAnalysisReport23_files/libs/clipboard/clipboard.min.js"></script>
<script src="preliminaryAnalysisReport23_files/libs/quarto-html/quarto.js"></script>
<script src="preliminaryAnalysisReport23_files/libs/quarto-html/popper.min.js"></script>
<script src="preliminaryAnalysisReport23_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="preliminaryAnalysisReport23_files/libs/quarto-html/anchor.min.js"></script>
<link href="preliminaryAnalysisReport23_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="preliminaryAnalysisReport23_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="preliminaryAnalysisReport23_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="preliminaryAnalysisReport23_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="preliminaryAnalysisReport23_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Streaked Horned Lark detectability and abundance: preliminary results</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>John D. Lloyd </p>
          </div>
  </div>
    
  
    
  </div>
  

</header>

<section id="encounter-rates" class="level1">
<h1>Encounter rates</h1>
<p>Streaked Horned Larks were detected at 13% (n = 28) of the 214 points surveyed in the Willamette Valley of Oregon in 2022 and 9% (n = 359) in 2023 (<a href="#tbl-encounterRates">Table&nbsp;1</a>).</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-encounterRates" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;1: Number of Streaked Horned Larks detected during surveys in the Willamette Valley of Oregon, 2022.</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">No. of larks detected</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">No. of survey points</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Frequency</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">186</td>
<td style="text-align: center;">0.87</td>
</tr>
<tr class="even">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">7</td>
<td style="text-align: center;">0.03</td>
</tr>
<tr class="even">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">5</td>
<td style="text-align: center;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">328</td>
<td style="text-align: center;">0.91</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">20</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="even">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">11</td>
<td style="text-align: center;">0.03</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>However, encounter rates of singing males were slightly lower (<a href="#tbl-encounterRatesSingingMales">Table&nbsp;2</a>). This is significant because it determines the sample size for the distance-sampling analysis, which is generally conducted only on singing males.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-encounterRatesSingingMales" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;2: Number of singing Streaked Horned Larks detected during surveys in the Willamette Valley of Oregon, 2022.</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">surveyYear</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">larksDetected</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">count</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">freq</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">194</td>
<td style="text-align: center;">0.91</td>
</tr>
<tr class="even">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">13</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: center;">2022</td>
<td style="text-align: center;">3</td>
<td style="text-align: center;">4</td>
<td style="text-align: center;">0.02</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">0</td>
<td style="text-align: center;">332</td>
<td style="text-align: center;">0.92</td>
</tr>
<tr class="even">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">1</td>
<td style="text-align: center;">21</td>
<td style="text-align: center;">0.06</td>
</tr>
<tr class="odd">
<td style="text-align: center;">2023</td>
<td style="text-align: center;">2</td>
<td style="text-align: center;">6</td>
<td style="text-align: center;">0.02</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
</section>
<section id="encounter-rates-did-not-change-over-the-survey-period-in-2023" class="level1">
<h1>Encounter rates did not change over the survey period in 2023</h1>
<p>Encounters with larks tended to decline over the course of the season in 2022 (<a href="#fig-detectionDates">Figure&nbsp;1</a>). Assuming that an earlier start to the season would yield more encounters, the 2023 season began more than 30 days earlier than the 2022 season (3 May in 2023 versus 7 June in 2022). However, in 2023, detections of larks were not strongly associated with the date on which a survey was conducted (<a href="#fig-detectionDates">Figure&nbsp;1</a>).</p>
<div class="cell fig-cap-location-bottom">
<div class="cell-output-display">
<div id="fig-detectionDates" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="preliminaryAnalysisReport23_files/figure-html/fig-detectionDates-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;1: Streaked Horned Lark detections as a function of survey date in the Willamette Valley of Oregon, 2022 and 2023.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="estimating-perceptibility-of-singing-larks-with-distance-sampling" class="level1">
<h1>Estimating perceptibility of singing larks with distance sampling</h1>
<p>Distance sampling estimates the extent of the decline in an observer’s ability to detect a bird as a function of the distance between the observer and bird. This parameter, referred to here as perceptibility, estimates the probability of detecting a bird within the survey area given that it was present during the survey and that it made itself available for detection, for example by singing. It does not account for birds present but unavailable for detection, for example because they did not sing and remained out of view.</p>
<p>Because distance sampling is sensitive to individual heterogeneity in the shape of the detection function, I adopted standard practice and limited this analysis to singing males. Non-singing males and females may have a different detection function (<a href="#tbl-sexAndCue">Table&nbsp;3</a>) and so including them in the analysis could introduce substantial bias. This decision reduces the sample size considerably; with a greater number of detections, models that include sex and detection type as covariates could be fit.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-sexAndCue" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;3: Streaked Horned Lark detections by sex and cue during surveys in the Willamette Valley of Oregon, 2022.</caption>
<thead>
<tr class="header">
<th style="text-align: right;" data-quarto-table-cell-role="th">Year</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Sex</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Detection type</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Number</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Calling</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Singing</td>
<td style="text-align: right;">31</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">7</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Calling</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: right;">2022</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Singing</td>
<td style="text-align: right;">18</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Male</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Singing</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Female</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Calling</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Singing</td>
<td style="text-align: right;">14</td>
</tr>
<tr class="odd">
<td style="text-align: right;">2023</td>
<td style="text-align: left;">Unknown</td>
<td style="text-align: left;">Visual</td>
<td style="text-align: right;">1</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Most of the singing males encountered during surveys were detected in the second and third distance bands (<a href="#fig-detectionDistances">Figure&nbsp;2</a>). That only a single detection was registered in the first distance band is not unexpected given that the area included in this band is substantially smaller than the area included in the other distance bands.</p>
<div class="cell fig-cap-location-bottom">
<div class="cell-output-display">
<div id="fig-detectionDistances" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="preliminaryAnalysisReport23_files/figure-html/fig-detectionDistances-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption class="figure-caption">Figure&nbsp;2: Streaked Horned Lark detection distances during surveys in the Willamette Valley of Oregon, 2022.</figcaption>
</figure>
</div>
</div>
</div>
<p>I considered models in the distance-sampling analysis that included individual effects of four potential covariates on perceptibility: day of the year (“day”), ambient noise (“noise”), temperature at the time of the survey (“temp”), and time of day (quantified as the number of minutes after sunrise (“MAS”) that the survey began). I also considered null models in which no covariates on perceptibility were included. I did not include any covariates on abundance, both because of sample size concerns and because we have yet to generate any covariates that might predict variation in abundance. I did not include models with more than one covariate due to the small sample size. I considered two suites of these individual-covariate models, one that assumed a half-normal (“hn”) detection function and one that assumed a hazard-rate (“ha”) detection function.</p>
<p>The best-supported model in the distance-sampling analysis was the null model with a half-normal detection function (<a href="#tbl-distanceAIC">Table&nbsp;4</a>). Model fit was adequate; chi-square and Freeman-Tukey statistics both suggested no deviation from model expectations (P = 0.31 and 0.42 respectively) but the sum-of-squared errors indicated overdispersion (P = 0.04). This values should be re-estimated after the data have been screened for data-entry errors. None of the covariates had a strong influence on perceptibility. In general, the hazard-rate models performed no better than the half-normal models, but required estimating one additional parameter and so tended to rank beneath half-normal models by about 2 AIC values.</p>
<div class="cell">
<div class="cell-output-display">
<div id="tbl-distanceAIC" class="anchored">
<table data-quarto-postprocess="true" class="table table-sm table-striped small">
<caption>Table&nbsp;4: Model selection results for distance-sampling analysis of Streaked Horned Lark detections during surveys in the Willamette Valley of Oregon, 2022.</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th"></th>
<th style="text-align: left;" data-quarto-table-cell-role="th">Model</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">No. parameters</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AICc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Delta AICc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Model likelihood</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">AICc weight</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Log-likelihood</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Cum. weight</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">6</td>
<td style="text-align: left;">hnNull</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">465.38</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">-230.68</td>
<td style="text-align: right;">0.18</td>
</tr>
<tr class="even">
<td style="text-align: left;">2</td>
<td style="text-align: left;">haDay</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">465.42</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.98</td>
<td style="text-align: right;">0.18</td>
<td style="text-align: right;">-228.68</td>
<td style="text-align: right;">0.36</td>
</tr>
<tr class="odd">
<td style="text-align: left;">7</td>
<td style="text-align: left;">hnDay</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">466.17</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.68</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">-230.06</td>
<td style="text-align: right;">0.49</td>
</tr>
<tr class="even">
<td style="text-align: left;">8</td>
<td style="text-align: left;">hnNoise</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">466.27</td>
<td style="text-align: right;">0.89</td>
<td style="text-align: right;">0.64</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">-230.12</td>
<td style="text-align: right;">0.60</td>
</tr>
<tr class="odd">
<td style="text-align: left;">10</td>
<td style="text-align: left;">hnTemp</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">466.39</td>
<td style="text-align: right;">1.01</td>
<td style="text-align: right;">0.60</td>
<td style="text-align: right;">0.11</td>
<td style="text-align: right;">-230.18</td>
<td style="text-align: right;">0.72</td>
</tr>
<tr class="even">
<td style="text-align: left;">1</td>
<td style="text-align: left;">haNull</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">466.90</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0.09</td>
<td style="text-align: right;">-230.43</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="odd">
<td style="text-align: left;">9</td>
<td style="text-align: left;">hnMAS</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">467.15</td>
<td style="text-align: right;">1.77</td>
<td style="text-align: right;">0.41</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">-230.55</td>
<td style="text-align: right;">0.88</td>
</tr>
<tr class="even">
<td style="text-align: left;">3</td>
<td style="text-align: left;">haNoise</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">468.16</td>
<td style="text-align: right;">2.78</td>
<td style="text-align: right;">0.25</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">-230.05</td>
<td style="text-align: right;">0.92</td>
</tr>
<tr class="odd">
<td style="text-align: left;">5</td>
<td style="text-align: left;">haTemp</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">468.31</td>
<td style="text-align: right;">2.93</td>
<td style="text-align: right;">0.23</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-230.12</td>
<td style="text-align: right;">0.96</td>
</tr>
<tr class="even">
<td style="text-align: left;">4</td>
<td style="text-align: left;">haMAS</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">468.69</td>
<td style="text-align: right;">3.30</td>
<td style="text-align: right;">0.19</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">-230.31</td>
<td style="text-align: right;">1.00</td>
</tr>
</tbody>
</table>
</div>


</div>
</div>
<p>Estimated perceptibility of streaked horned larks was 0.14 (95% CI = 0.11 - 0.19). With the low estimated perceptibility of larks, the resulting abundance estimate from the best distance model was also quite high: 1.3 larks per km<sup>2</sup> (95% CI = 0.6 - 1.6).</p>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>